<div class="live-card">
  <header class="live-card__header">
    <span class="live-card__badge">Realtime stream</span>
    <h3>Live transcription console</h3>
    <p>Toggle captioning on demand and keep the stream focused with adaptive typography.</p>
  </header>

  <div class="live-card__controls">
    <button type="button"
            class="live-card__button"
            [class.is-active]="isLiveTranscribing"
            (click)="toggleLiveTranscription()">
      {{ isLiveTranscribing ? 'Stop live transcription' : 'Start live transcription' }}
    </button>
    <button type="button" class="live-card__button live-card__button--ghost" (click)="onSettingsTileClick()">
      Configure
    </button>
  </div>

  <div class="live-card__status" *ngIf="(transcriberService?.progressItems?.length ?? 0) > 0">
    <span class="live-card__spinner" aria-hidden="true"></span>
    Loading model files... this only runs once.
  </div>

  <div class="live-card__stream" [class.is-active]="isLiveTranscribing">
    <div class="live-card__ticker" [class.is-empty]="!liveTranscript">
      <p>{{ liveTranscript || 'Waiting for microphone input...' }}</p>
    </div>
  </div>
</div>

<div class="modal" *ngIf="showSettingsModal">
  <div class="modal__overlay" (click)="onSettingsModalClose()"></div>
  <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="live-settings-title">
    <div class="modal__header">
      <h3 id="live-settings-title">Transcription settings</h3>
      <p>Pick a Whisper model and advanced options for live captioning.</p>
    </div>
    <label class="modal__field">
      <span>Model variant</span>
      <select [(ngModel)]="transcriberService.model">
        <option value="Xenova/whisper-tiny">Xenova/whisper-tiny</option>
        <option value="Xenova/whisper-base">Xenova/whisper-base</option>
        <option value="Xenova/whisper-small">Xenova/whisper-small</option>
        <option value="Xenova/whisper-medium">Xenova/whisper-medium</option>
      </select>
    </label>
    <div class="modal__checkboxes">
      <label>
        <input id="live-multilingual" type="checkbox" [(ngModel)]="transcriberService.multilingual" />
        <span>Enable multilingual decoding</span>
      </label>
      <label>
        <input id="live-quantized" type="checkbox" [(ngModel)]="transcriberService.quantized" />
        <span>Use quantized weights</span>
      </label>
    </div>
    <div class="modal__grid" *ngIf="transcriberService.multilingual">
      <label class="modal__field">
        <span>Source language</span>
        <select [(ngModel)]="transcriberService.language">
          <option value="en">English</option>
          <option value="zh">Chinese</option>
          <option value="de">German</option>
        </select>
      </label>
      <label class="modal__field">
        <span>Task</span>
        <select [(ngModel)]="transcriberService.subtask">
          <option value="transcribe">Transcribe</option>
          <option value="translate">Translate (to English)</option>
        </select>
      </label>
    </div>
    <div class="modal__actions">
      <button type="button" class="live-card__button" (click)="onSettingsModalSubmit()">Save</button>
      <button type="button" class="live-card__button live-card__button--ghost" (click)="onSettingsModalClose()">Cancel</button>
    </div>
  </div>
</div>
